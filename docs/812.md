# 多态数据介绍

> 原文：<https://jenkov.com/tutorials/polymorph-data/index.html>

*多态数据*是包含在[多态智能媒体平台](/tutorials/polymorph/index.html) 项目中的数据格式的当前名称。多态数据是一种非常高级的数据格式，设计用于网络协议+数据交换 以及文件存储的数据格式。多态数据是一种二进制数据格式，因为这样更容易满足 设计目标(稍后说明)。

这是一个既有纯二进制编码又有可编辑文本编码的计划——外加在两个编码版本之间转换的工具。首先，这种可编辑的编码很可能会被修改，以便能够高效、轻松地表达多形数据编码，但也许它也能够高效地表达其他类型的二进制编码。我还没有决定。

二进制和文本数据编码也有别名 Pinary(多态二进制)和 Tinary(文本二进制)。我不确定这些名字是否会被记住，但是如果你看到它们，至少你知道它们指的是什么。个人文件可以使用扩展名。pin 和 Tinary 文件扩展名。tin——因此，如果您在多态上下文中看到这些扩展名，您就会对它们所代表的文件类型有所了解。

## 多态数据设计目标

多态数据格式是根据以下设计目标设计的:

*   高通用性
*   高读写性能
*   压缩编码-小尺寸

## 多态数据特征

这些设计目标导致了具有以下特征的多态数据格式:

*   **通用性高**
    *   自描述-不需要模式。
    *   预定义了许多核心数据类型。
    *   对象数据类型(键->类值属性)。
    *   循环+非循环对象图支持。
    *   CSV 或 DB 结果集样式数据的表格数据类型。
    *   高度可扩展-自定义字段。

*   **压缩编码**
    *   TLLV 编码，对大多数数据类型进行压缩编码。
    *   通过嵌套表压缩表格数据和树结构。
    *   复制或引用数据块(如文件或消息)中较早的字段，以减少数据冗余。

*   **快速阅读**
    *   快速且易于解码。
    *   流畅的阅读。
    *   部分可读性。
    *   任意层次导航。

*   **快速写作**
    *   紧凑编码意味着需要写入的字节更少，从而提高写入性能。
    *   简单编码比更复杂的编码需要编写更少的指令。

## 多态数据类型

多态数据被编码为字段。每个字段都有一种数据类型。多态数据字段类型分为两类:

*   原子类型
*   复合类型

原子类型是包含单个值的字段。例如，单个数字、文本、日期等。

复合类型是包含嵌套在其中的其他字段的字段。

### 原子数据类型

多态数据可以表达以下核心原子数据类型:

| 布尔代数学体系的 | true、false 或 null 值。 |
| 整数 | 最多 64 位整数(目前)，或 null。 |
| 浮动 | 32 位和 64 位浮点数(目前)，或者空。 |
| 字节 | 长达 2^64 字节的长字节序列，或为空。 |
| UTF-8 | 长达 2^64 字节的 UTF-8 序列，或空。 |
| 协调世界时。亦称 COORDINATED UNIVERSAL TIME | 精确到纳秒的 UTC 时间。 |
| 复制(*) | 表示在数据块中较早发现的 2^64 字节的字段的“副本”(*尚未决定是否包括它)。 |
| 参考 | 引用在数据块中较早找到的 2^64 字节的字段。用于表示循环对象图。 |

### 复合数据类型

多态数据可以表达以下核心复合数据类型:

| 桌子 | 表格数据集。列名只包含一次，后面是表中的所有行。可以递归地使用嵌套在表中的表来有效地表达树结构。 |
| 目标 | 属性建模为键+值对的对象。也可用于地图(字典)。可以递归地包含嵌套的对象或表。如果需要，紧凑对象编码可以省去键。 |
| 钥匙 | 对象内属性(字段)的名称。 |
| 类型(*) | 用户定义的类型，例如对象或数据块。例如，类名或 mime 类型(*尚未决定是否包括在内)。 |

注意:目前正在重新检查复合字段的具体编码——看看是否有可能提出一种稍微更灵活的编码，允许更多的复合字段类型——而不增加太多的额外字节来表示额外的字段类型。

虽然每个字段的大小都有上限，但文件或字段流的大小没有上限。

## 多态数据与其他数据格式

多态数据旨在与以下数据格式竞争:

*   消息包
*   CBOR
*   里奥
*   离子(来自亚马逊)
*   原蟾蜍

MessagePack、CBOR、RION、ION 和多态数据都使用类似的 TLLV 编码。多态使用一种更类似于 MessagePack 和 CBOR 的编码，同时拥有 RION 的所有高级数据类型。

我还没有对多态数据进行基准测试，但性能应该类似于 MessagePack，CBOR，RION 和 ION。编码在 som 部分比 RION 简单一点，所以读写速度可能会高一点，但在做出任何肯定的声明之前，我必须验证这一点。