# 对等连接

> 原文:[https://jenkov.com/tutorials/p2p/peer-connectivity.html](https://jenkov.com/tutorials/p2p/peer-connectivity.html)

想要形成对等(P2P)网络的对等点需要能够相互通信。为了相互通信，对等体需要能够通过互联网相互连接。

如果对等机运行在位于进行 NAT 的路由器后面或防火墙后面的计算机上，它们可能无法直接相互连接。NAT 或防火墙后的对等体通常可以连接到 Internet，但不能通过 NAT 路由器或防火墙接收连接(除非明确配置为允许入站连接)。

![Peers needing to connect.](../Images/fe17519629343684f72329cd152785c7.png)

## 公共同行

对于位于 NAT 或防火墙之后的对等体的问题，通常的解决方案是从检测网络中不在 NAT 或防火墙之后的对等体开始。有些 P2P 系统称之为*超级节点*。我称这些节点为*公共节点*，因为它们可以被网络中的 其他对等体访问。他们可以说是“公共的”。防火墙 NAT 后的对等体我称之为“私有”对等体。

解决方案的第二步是让私有对等体连接到公共对等体。这样，私有对等体可以直接与公共对等体通信，并通过公共对等体间接与其他私有对等体通信。

![Private peers communicating with, and via, public peers.](../Images/d182c7aca7c24ac9d48670f6c54ef122.png)

## 托管公共对等机

如果 P2P 网络完全依赖于用户自己提供的公共节点，则会导致糟糕的用户体验。挑战在于，您无法控制有多少公共用户——也就是说，有多少加入网络的用户不在 NAT 或防火墙之后。如果网络只包含几个公共节点，这些公共节点就成了瓶颈，换句话说就是拥塞点。

这个问题的解决方案是让 P2P 应用程序的创建者自己托管一定数量的公共对等点，以确保有足够多的公共对等点来提供良好的用户体验。诚然，这意味着系统不完全依赖于用户带宽和 CPU，但如果 P2P 应用程序感觉缓慢和滞后，那么自己托管一些公共节点可能是值得的。